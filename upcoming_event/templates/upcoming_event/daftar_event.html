{% extends 'base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">

<div class="max-w-5xl mx-auto px-6 py-10">
  <h1 class="upcoming-title">🏅 Upcoming Events</h1>

  {% if user.is_authenticated and user.is_superuser %}
  <a href="{% url 'upcoming_event:add_event' %}"  
     class="inline-block bg-[#0A1A3C] text-white px-4 py-2 rounded-lg mb-6 hover:bg-[#142955] transition">
     + Add Upcoming Event
  </a>
  {% endif %}

<!-- 🔍 Search + Clear -->
<form method="get" action="{% url 'upcoming_event:daftar_event' %}" class="mb-6 flex items-center gap-2">
  <div class="relative flex-1">
    <input 
      type="text" 
      name="q" 
      value="{{ query|default:'' }}" 
      placeholder="Search events by name, location, or organizer..." 
      class="w-full px-4 py-2 rounded-lg border border-gray-300 
             focus:outline-none focus:ring-2 focus:ring-yellow-400
             bg-white text-black"
    >
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-3 top-2.5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 104.5 4.5a7.5 7.5 0 0012.15 12.15z" />
    </svg>
  </div>

  <!-- Tombol Search -->
  <button type="submit" 
    class="bg-[#1E3A8A] hover:bg-[#142955] text-white px-4 py-2 rounded-lg text-base font-semibold transition">
    Search
  </button>

  <!-- Tombol Clear (hanya muncul kalau query ada) -->
  {% if query %}
  <a href="{% url 'upcoming_event:daftar_event' %}" 
     class="bg-yellow-400 hover:bg-yellow-500 text-black px-4 py-2 rounded-lg text-base font-semibold transition inline-block">
    Clear
  </a>
  {% endif %}
</form>

  <!-- 🧾 Kondisi hasil pencarian / daftar event -->
  {% if events %}
    <!-- kalau ada event -->
    <div id="event-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for event in events %}
      <article class="event-card bg-white rounded-2xl border border-gray-200 hover:shadow-lg transition-all duration-300 overflow-hidden"
               data-id="{{ event.id }}">
        <div class="aspect-[16/9] relative overflow-hidden">
          {% if event.image_url %}
          <img src="{{ event.image_url }}" alt="{{ event.name }}" class="w-full h-full object-cover hover:scale-105 transition-transform duration-500">
          {% else %}
          <div class="w-full h-full bg-gray-200 flex items-center justify-center text-gray-400 text-sm">
            No Image
          </div>
          {% endif %}
        </div>

        <div class="p-5">
          <p class="text-gray-500 text-sm mb-2">📅 {{ event.date }}</p>
          <h3 class="text-lg font-semibold text-gray-900 mb-2">{{ event.name }}</h3>
          <p class="text-gray-600 text-sm mb-4">📍 {{ event.location }}</p>

          <div class="flex items-center justify-between pt-3 border-t border-gray-100">
            <button class="lihat-detail-btn text-[#0A1A3C] hover:text-[#163A77] font-medium text-sm transition"
                    data-id="{{ event.id }}">
              See Detail →
            </button>

            {% if user.is_authenticated and user.is_superuser %}
            <div class="flex space-x-3">
              <a href="{% url 'upcoming_event:edit_event' event.id %}" class="text-gray-600 hover:text-gray-800 text-sm transition">Edit</a>
              <button class="hapus-event-btn text-red-600 hover:text-red-700 text-sm transition"
                      data-id="{{ event.id }}">
                Delete Event
              </button>
            </div>
            {% endif %}
          </div>
        </div>
      </article>
      {% endfor %}
    </div>

    <div id="event-detail" class="mt-10"></div>

  {% else %}
    <!-- tidak ada event -->
    {% if query %}
      <!-- tidak ditemukan -->
      <div class="mt-4 text-white text-base text-center">
        No events found matching "{{ query }}".
      </div>
    {% else %}
      <!-- belum ada event sama sekali -->
      <p class="mt-4 text-white text-base text-center">
        There are no upcoming events yet.
      </p>
    {% endif %}
  {% endif %}
</div>

<script src="{% static 'upcoming_event/js/toast.js' %}?v=7"></script>
<script src="{% static 'upcoming_event/js/upcoming_event.js' %}?v=7"></script>
{% endblock %}

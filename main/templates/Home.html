{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Forums</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#f9fafb] text-[#1f2937]">
  <section class="w-full bg-[#f3f4f6] border-b border-[#d1d5db]">
    <div class="container mx-auto px-4 py-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
      <h2 class="text-2xl font-semibold">
        Currently active forums: {{count}}
      </h2>
      <form method="POST" action="{% url 'main:addInForum' %}" class="flex">
        {% csrf_token %}
        <button
          class="w-auto px-3 py-1.5 rounded-md bg-[#16a34a] hover:bg-[#15803d] text-[#ffffff] text-sm font-medium shadow-sm transition"
          type="submit">
          Add more
        </button>
      </form>
    </div>
  </section>

  <main class="container mx-auto px-4 py-6">
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      {% for forum in forums %}
        <article class="bg-[#ffffff] border-2 border-[#535353] rounded-xl mx-15">
          <div class="p-5">
            <div class="flex items-center justify-between gap-3 mb-3">
                <h3 class="text-xl font-semibold m-0 truncate">{{ forum.topic }}</h3>
                <span class="text-xs text-[#64748b] whitespace-nowrap">
                    Posted on {{ forum.date_created|date:"M d, Y H:i" }}
                </span>
                {% if forum.name == request.user or request.user.is_superuser%}
                <form method="POST" action="{% url 'main:delete_forum' forum.id %}" class="shrink-0">
                    {% csrf_token %}
                    <button
                    type="submit"
                    class="px-3 py-1.5 rounded-md bg-[#dc2626] hover:bg-[#b91c1c] text-[#ffffff] text-sm font-medium shadow-sm transition whitespace">
                    Delete Forum
                    </button>
                </form>
                {% endif %}
            </div>

            <div class="text-sm leading-6 text-[#334155]">
              <p>{{ forum.description }}</p>
            </div>

            <hr class="my-4 border-[#d1d5db]">

           
            <p class="text-sm text-[#475569] mb-2">
              By: <b class="text-[#1f2937]">{{ forum.name }}</b>
            </p>

            <hr class="my-4 border-[#d1d5db]">

            <h4 class="text-lg font-semibold mb-2">Replies from other users</h4>

            <div class="text-sm space-y-1 mb-4">
            {% for thread in discussions %}
                {% for objs in thread %}
                {% if objs.forum_id == forum.id %}
                    <div class="py-1">
                    <div class="flex items-center justify-between gap-3">
                        <div class="flex-1">
                        {{ objs.discuss }}
                            <span class="text-xs text-[#64748b] whitespace-nowrap">
                                Posted on {{ objs.date_created|date:"M d, Y H:i" }}
                            </span>
                        </div>

                        <div class="flex items-center gap-2 shrink-0">
                        <b class="italic text-[#0b1936]">| {{ objs.username.username }}</b>

                        {% if  objs.username == request.user or request.user.is_superuser %}
                            <form method="POST" action="{% url 'main:delete_discussion' objs.id %}" class="inline-block">
                            {% csrf_token %}
                            <button
                                type="submit"
                                class="px-2 py-1 rounded-md hover:text-[#000000] text-[#dc2626] text-xs font-medium shadow-sm transition">
                                Delete
                            </button>
                            </form>
                        {% endif %}
                        </div>
                    </div>

                    <hr class="my-2 border-[#d1d5db]">
                    </div>
                {% endif %}
                {% endfor %}
            {% endfor %}
            </div>


            <form method="POST" action="{% url 'main:addInDiscussion' %}">
              {% csrf_token %}
              <button
                type="submit"
                class="w-[8%] min-w-[72px] px-3 py-1.5 rounded-md bg-[#16a34a] hover:bg-[#15803d] text-[#ffffff] text-sm font-medium shadow-sm transition">
                Reply
              </button>
            </form>
          </div>
        </article>
      {% endfor %}
    </div>
  </main>
</body>
</html>
